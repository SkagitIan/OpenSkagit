{% load humanize %}
<div class="message {{ role }}">
  <div class="message-role">{{ role }}</div>
  <div class="message-content">
    {% if role == "user" %}
      {{ content|linebreaksbr }}
    {% else %}
      {{ content|safe }}
      {% if sources %}
        <div style="margin-top: 0.75rem; padding-top: 0.75rem; border-top: 1px dashed var(--os-light-gray); font-size: 0.8125rem; color: var(--os-warm-gray);">
          <strong style="color: var(--os-charcoal);">Sources:</strong>
          {% for s in sources %}
            <span style="display: inline-flex; align-items: center; gap: 0.25rem; background: var(--os-off-white); padding: 0.25rem 0.5rem; border-radius: 12px; font-size: 0.75rem; margin-right: 0.5rem; margin-top: 0.25rem;">
              <span>#{{ forloop.counter }}</span>
              {% if s.parcel_number %}
                <span>{{ s.parcel_number }}</span>
              {% endif %}
              {% if s.address %}
                <span style="max-width: 10rem; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">{{ s.address }}</span>
              {% endif %}
              {% if s.distance is not None %}
                <span>{{ s.distance|floatformat:2 }}mi</span>
              {% endif %}
            </span>
          {% empty %}
            <span>No related parcels returned.</span>
          {% endfor %}
        </div>
      {% endif %}
    {% endif %}
  </div>
</div>
