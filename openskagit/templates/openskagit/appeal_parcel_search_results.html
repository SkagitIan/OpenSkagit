{% load humanize %}
{% if query_too_short %}
  <div class="rounded-lg border border-slate-200 bg-slate-50 px-4 py-3 text-sm text-slate-600">
    Enter at least {{ min_search_length|default:3 }} characters to search.
  </div>
{% elif query %}
  {% if results %}
    <div class="space-y-3">
      {% for parcel in results %}
        {% with sale_price=parcel.sale_price sale_date=parcel.sale_date %}
          <a class="home-card"
             href="{% url 'appeal-result' parcel.parcel_number %}"
             data-address="{{ parcel.address|default:'Address unavailable'|escape }}"
             data-parcel="{{ parcel.parcel_number|escape }}"
             data-details="{% if sale_price and sale_date %}Last sold for ${{ sale_price|floatformat:0|intcomma }} on {{ sale_date|date:'M j, Y' }}{% elif sale_price %}Last sold for ${{ sale_price|floatformat:0|intcomma }}{% elif sale_date %}Last recorded sale {{ sale_date|date:'M j, Y' }}{% endif %}">
            <div class="home-card-info">
              <p class="home-card-title">{{ parcel.address|default:"Address unavailable" }}</p>
              <p class="home-card-parcel">Parcel {{ parcel.parcel_number }}</p>
              {% if sale_price %}
                <p class="home-card-details">
                  Sold: ${{ sale_price|floatformat:0|intcomma }}{% if sale_date %} · {{ sale_date|date:"M j, Y" }}{% endif %}
                </p>
              {% elif sale_date %}
                <p class="home-card-details">Last sale {{ sale_date|date:"M j, Y" }}</p>
              {% else %}
                <p class="home-card-details text-slate-500">Sale info unavailable</p>
              {% endif %}
            </div>
            <div class="home-card-cta">
              <span class="home-card-focus">Select to continue →</span>
              <span class="home-card-cta-note">Jump directly to Step 2</span>
            </div>
          </a>
        {% endwith %}
      {% endfor %}
    </div>
  {% else %}
    <div class="rounded-lg border border-rose-200 bg-rose-50 px-4 py-3 text-sm text-rose-700">No matches for “{{ query }}”. Try the parcel number or street.</div>
  {% endif %}
{% else %}
  <div class="text-sm text-slate-500">Start typing to find your home…</div>
{% endif %}
