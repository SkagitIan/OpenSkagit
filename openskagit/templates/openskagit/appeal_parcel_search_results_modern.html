{% load humanize %}
{% if query_too_short %}
  <div class="empty-state">
    <svg class="empty-state__icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <circle cx="11" cy="11" r="8"></circle>
      <path d="m21 21-4.35-4.35"></path>
    </svg>
    <div class="empty-state__text">Enter at least {{ min_search_length|default:3 }} characters to search</div>
  </div>
{% elif query %}
  {% if results %}
    {% for parcel in results %}
      {% with sale_price=parcel.sale_price sale_date=parcel.sale_date %}
        <a class="search-result-item"
           href="{% url 'appeal-result' parcel.parcel_number %}"
           data-address="{{ parcel.address|default:'Address unavailable'|escape }}"
           data-parcel="{{ parcel.parcel_number|escape }}"
           data-details="{% if sale_price and sale_date %}Last sold for ${{ sale_price|floatformat:0|intcomma }} on {{ sale_date|date:'M j, Y' }}{% elif sale_price %}Last sold for ${{ sale_price|floatformat:0|intcomma }}{% elif sale_date %}Last recorded sale {{ sale_date|date:'M j, Y' }}{% endif %}">
          <div class="search-result__content">
            <div class="search-result__title">{{ parcel.address|default:"Address unavailable" }}</div>
            <div class="search-result__meta">
              <span>
                <svg style="width: 0.875rem; height: 0.875rem; display: inline-block; vertical-align: middle; margin-right: 4px;" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                </svg>
                {{ parcel.parcel_number }}
              </span>
              {% if sale_price %}
                <span class="search-result__badge">
                  <svg style="width: 0.75rem; height: 0.75rem;" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="12" y1="1" x2="12" y2="23"></line>
                    <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path>
                  </svg>
                  Sold: ${{ sale_price|floatformat:0|intcomma }}
                </span>
              {% endif %}
              {% if sale_date %}
                <span style="color: var(--gray-500);">{{ sale_date|date:"M j, Y" }}</span>
              {% endif %}
            </div>
          </div>
          <div class="search-result__action">
            Select
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="5" y1="12" x2="19" y2="12"></line>
              <polyline points="12 5 19 12 12 19"></polyline>
            </svg>
          </div>
        </a>
      {% endwith %}
    {% endfor %}
  {% else %}
    <div class="empty-state">
      <svg class="empty-state__icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <circle cx="12" cy="12" r="10"></circle>
        <line x1="15" y1="9" x2="9" y2="15"></line>
        <line x1="9" y1="9" x2="15" y2="15"></line>
      </svg>
      <div class="empty-state__text">No properties found for "{{ query }}". Try a different address or parcel number.</div>
    </div>
  {% endif %}
{% else %}
  <div class="empty-state">
    <svg class="empty-state__icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <circle cx="11" cy="11" r="8"></circle>
      <path d="m21 21-4.35-4.35"></path>
    </svg>
    <div class="empty-state__text">Start typing to find your property...</div>
  </div>
{% endif %}
